{"ast":null,"code":"import axios from'axios';const api=axios.create({baseURL:process.env.REACT_APP_API_URL||''});api.interceptors.request.use(config=>{const token=sessionStorage.getItem('accessToken');if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;});api.interceptors.response.use(response=>response,async error=>{const originalRequest=error.config;if(error.response&&error.response.status===401&&!originalRequest._retry){originalRequest._retry=true;try{const refreshToken=localStorage.getItem('refreshToken');const res=await axios.post('/oauth/refresh-token',{refreshToken:refreshToken});const newAccessToken=res.data.accessToken;sessionStorage.setItem('accessToken',newAccessToken);window.location.reload();originalRequest.headers.Authorization='Bearer '+newAccessToken;return axios(originalRequest);}catch(e){console.error('Refresh token не сработал');sessionStorage.removeItem('accessToken');localStorage.removeItem('refreshToken');sessionStorage.removeItem('user');if(window.location.pathname!=='/login'){window.location.href='/login';}}}return Promise.reject(error);});export default api;","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_URL","interceptors","request","use","config","token","sessionStorage","getItem","headers","Authorization","concat","response","error","originalRequest","status","_retry","refreshToken","localStorage","res","post","newAccessToken","data","accessToken","setItem","window","location","reload","e","console","removeItem","pathname","href","Promise","reject"],"sources":["D:/progects/SoftArex/FrontEnd/src/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst api = axios.create({\r\n    baseURL: process.env.REACT_APP_API_URL || '',\r\n});\r\napi.interceptors.request.use(config => {\r\n    const token =  sessionStorage.getItem('accessToken');\r\n    if (token) {\r\n        config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n});\r\n\r\napi.interceptors.response.use(\r\n    response => response,\r\n    async error => {\r\n        const originalRequest = error.config;\r\n\r\n\r\n        if (error.response && error.response.status === 401 && !originalRequest._retry) {\r\n            originalRequest._retry = true;\r\n\r\n            try {\r\n                const refreshToken = localStorage.getItem('refreshToken');\r\n\r\n                const res = await axios.post('/oauth/refresh-token', {\r\n                    refreshToken: refreshToken\r\n                });\r\n\r\n                const newAccessToken = res.data.accessToken;\r\n\r\n                sessionStorage.setItem('accessToken', newAccessToken);\r\n                window.location.reload();\r\n\r\n                originalRequest.headers.Authorization = 'Bearer ' + newAccessToken;\r\n                return axios(originalRequest);\r\n\r\n            } catch (e) {\r\n                console.error('Refresh token не сработал');\r\n                sessionStorage.removeItem('accessToken');\r\n                localStorage.removeItem('refreshToken');\r\n                sessionStorage.removeItem('user');\r\n                if(window.location.pathname !== '/login') {\r\n                    window.location.href = '/login';\r\n                }\r\n            }\r\n        }\r\n\r\n        return Promise.reject(error);\r\n    }\r\n);\r\nexport default api;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,KAAM,CAAAC,GAAG,CAAGD,KAAK,CAACE,MAAM,CAAC,CACrBC,OAAO,CAAEC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,EAC9C,CAAC,CAAC,CACFL,GAAG,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CAACC,MAAM,EAAI,CACnC,KAAM,CAAAC,KAAK,CAAIC,cAAc,CAACC,OAAO,CAAC,aAAa,CAAC,CACpD,GAAIF,KAAK,CAAE,CACPD,MAAM,CAACI,OAAO,CAACC,aAAa,WAAAC,MAAA,CAAaL,KAAK,CAAE,CACpD,CACA,MAAO,CAAAD,MAAM,CACjB,CAAC,CAAC,CAEFT,GAAG,CAACM,YAAY,CAACU,QAAQ,CAACR,GAAG,CACzBQ,QAAQ,EAAIA,QAAQ,CACpB,KAAM,CAAAC,KAAK,EAAI,CACX,KAAM,CAAAC,eAAe,CAAGD,KAAK,CAACR,MAAM,CAGpC,GAAIQ,KAAK,CAACD,QAAQ,EAAIC,KAAK,CAACD,QAAQ,CAACG,MAAM,GAAK,GAAG,EAAI,CAACD,eAAe,CAACE,MAAM,CAAE,CAC5EF,eAAe,CAACE,MAAM,CAAG,IAAI,CAE7B,GAAI,CACA,KAAM,CAAAC,YAAY,CAAGC,YAAY,CAACV,OAAO,CAAC,cAAc,CAAC,CAEzD,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAAxB,KAAK,CAACyB,IAAI,CAAC,sBAAsB,CAAE,CACjDH,YAAY,CAAEA,YAClB,CAAC,CAAC,CAEF,KAAM,CAAAI,cAAc,CAAGF,GAAG,CAACG,IAAI,CAACC,WAAW,CAE3ChB,cAAc,CAACiB,OAAO,CAAC,aAAa,CAAEH,cAAc,CAAC,CACrDI,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,CAExBb,eAAe,CAACL,OAAO,CAACC,aAAa,CAAG,SAAS,CAAGW,cAAc,CAClE,MAAO,CAAA1B,KAAK,CAACmB,eAAe,CAAC,CAEjC,CAAE,MAAOc,CAAC,CAAE,CACRC,OAAO,CAAChB,KAAK,CAAC,2BAA2B,CAAC,CAC1CN,cAAc,CAACuB,UAAU,CAAC,aAAa,CAAC,CACxCZ,YAAY,CAACY,UAAU,CAAC,cAAc,CAAC,CACvCvB,cAAc,CAACuB,UAAU,CAAC,MAAM,CAAC,CACjC,GAAGL,MAAM,CAACC,QAAQ,CAACK,QAAQ,GAAK,QAAQ,CAAE,CACtCN,MAAM,CAACC,QAAQ,CAACM,IAAI,CAAG,QAAQ,CACnC,CACJ,CACJ,CAEA,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACrB,KAAK,CAAC,CAChC,CACJ,CAAC,CACD,cAAe,CAAAjB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}